<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Admin Note Control Panel</title>
    <link rel="stylesheet" href="styles.css"> 
    <style>
        /* Admin Panel á€¡á€á€½á€€á€º CSS */
        .admin-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 25px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        form { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 6px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea { resize: vertical; height: 100px; }
        button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }
        button:hover { background-color: #218838; }
        .delete-btn { background-color: #dc3545; margin-left: 10px; }
        .delete-btn:hover { background-color: #c82333; }
        .edit-btn { background-color: #ffc107; color: #333; }
        .edit-btn:hover { background-color: #e0a800; }

        .note-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px dashed #eee;
        }
        .note-list-item:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>ğŸ” Admin Control Panel</h1>

        <form id="note-form">
            <h3>á€™á€¾á€á€ºá€…á€¯á€¡á€á€…á€º á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€›á€”á€º</h3>
            
            <label for="admin-key">Admin Password:</label>
            <input type="password" id="admin-key" required>

            <label for="note-title">á€á€±á€«á€„á€ºá€¸á€…á€‰á€º:</label>
            <input type="text" id="note-title" required>

            <label for="note-category">á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸:</label>
            <input type="text" id="note-category" value="General">

            <label for="note-content">á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬:</label>
            <textarea id="note-content" required></textarea>

            <button type="submit" id="submit-button">á€™á€¾á€á€ºá€…á€¯ á€á€„á€ºá€á€½á€„á€ºá€¸á€™á€Šá€º</button>
            <button type="button" id="cancel-edit-button" style="display:none; background-color: #6c757d;">Cancel</button>
        </form>
        
        <div id="status-message" style="margin-top: 15px; font-weight: bold;"></div>

        <hr>

        <h3>ğŸ“ á€œá€€á€ºá€›á€¾á€­ á€™á€¾á€á€ºá€…á€¯á€™á€»á€¬á€¸</h3>
        <div id="notes-list-container">
            <p>á€™á€¾á€á€ºá€…á€¯á€…á€¬á€›á€„á€ºá€¸ Loading á€œá€¯á€•á€ºá€”á€±á€•á€«á€á€Šá€ºá‹...</p>
        </div>
    </div>

    <script>
        // Worker API á URL á€€á€­á€¯ á€¤á€”á€±á€›á€¬á€á€½á€„á€º á€á€±á€á€»á€¬á€…á€½á€¬ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€•á€«
        const API_URL = 'YOUR_DEPLOYED_WORKER_URL'; 
        
        const form = document.getElementById('note-form');
        const submitButton = document.getElementById('submit-button');
        const cancelEditButton = document.getElementById('cancel-edit-button');
        const statusDiv = document.getElementById('status-message');
        const notesListContainer = document.getElementById('notes-list-container');
        
        let editingNoteId = null; // á€•á€¼á€„á€ºá€†á€„á€ºá€”á€±á€á€±á€¬ á€™á€¾á€á€ºá€…á€¯ ID

        // -----------------------------------------------------------------
        // 1. á€™á€¾á€á€ºá€…á€¯á€™á€»á€¬á€¸ á€…á€¬á€›á€„á€ºá€¸ á€•á€¼á€”á€ºá€œá€Šá€ºá€šá€°á€†á€±á€¬á€„á€ºá€á€¼á€„á€ºá€¸ (Reload List)
        // -----------------------------------------------------------------
        async function loadNotesForAdmin() {
            notesListContainer.innerHTML = 'á€™á€¾á€á€ºá€…á€¯á€…á€¬á€›á€„á€ºá€¸ á€›á€¾á€¬á€–á€½á€±á€”á€±á€•á€«á€á€Šá€ºá‹...';
            try {
                const response = await fetch(`${API_URL}/notes`);
                const notes = await response.json();
                
                notesListContainer.innerHTML = '';
                
                if (notes.length === 0) {
                    notesListContainer.innerHTML = '<p>á€™á€¾á€á€ºá€…á€¯á€™á€»á€¬á€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹</p>';
                    return;
                }

                notes.forEach(note => {
                    const item = document.createElement('div');
                    item.className = 'note-list-item';
                    item.innerHTML = `
                        <div style="flex-grow: 1;">
                            <strong>${note.title}</strong> 
                            <small>(${note.category}) - ID: ${note.id}</small>
                        </div>
                        <div>
                            <button class="edit-btn" data-id="${note.id}" data-note='${JSON.stringify(note)}'>á€•á€¼á€„á€ºá€†á€„á€ºá€›á€”á€º</button>
                            <button class="delete-btn" data-id="${note.id}">á€–á€»á€€á€ºá€›á€”á€º</button>
                        </div>
                    `;
                    notesListContainer.appendChild(item);
                });
            } catch (error) {
                notesListContainer.innerHTML = '<p style="color:red;">á€™á€¾á€á€ºá€…á€¯á€…á€¬á€›á€„á€ºá€¸á€€á€­á€¯ á€›á€šá€°á€›á€¬á€á€½á€„á€º á€¡á€™á€¾á€¬á€¸á€•á€±á€«á€ºá€•á€±á€«á€€á€ºá€•á€«á€á€Šá€º: ' + error.message + '</p>';
            }
        }

        // -----------------------------------------------------------------
        // 2. Submit/Update á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€º
        // -----------------------------------------------------------------
        async function handleNoteSubmission() {
            const adminKey = document.getElementById('admin-key').value;
            const title = document.getElementById('note-title').value;
            const content = document.getElementById('note-content').value;
            const category = document.getElementById('note-category').value;
            
            statusDiv.textContent = 'á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€”á€±á€•á€«á€á€Šá€ºá‹...';

            const payload = { title, content, category };
            let method = 'POST';
            let url = `${API_URL}/notes`;
            
            if (editingNoteId) {
                method = 'PUT'; // á€•á€¼á€„á€ºá€†á€„á€ºá€”á€±á€›á€„á€º PUT á€á€¯á€¶á€¸
                url = `${API_URL}/notes/${editingNoteId}`;
            }
            
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Key': adminKey 
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    statusDiv.style.color = 'green';
                    statusDiv.textContent = `${editingNoteId ? 'á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸' : 'á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸'} á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á€á€Šá€ºá‹`;
                    
                    form.reset(); // Form á€›á€¾á€„á€ºá€¸á€‘á€¯á€á€º
                    editingNoteId = null; 
                    submitButton.textContent = 'á€™á€¾á€á€ºá€…á€¯ á€á€„á€ºá€á€½á€„á€ºá€¸á€™á€Šá€º';
                    cancelEditButton.style.display = 'none';

                    loadNotesForAdmin(); // á€…á€¬á€›á€„á€ºá€¸ á€¡á€á€…á€ºá€•á€¼á€”á€ºá€á€±á€«á€º
                } else if (response.status === 401) {
                    statusDiv.style.color = 'red';
                    statusDiv.textContent = 'âŒ á€á€„á€ºá€á€½á€„á€ºá€¸á€á€½á€„á€·á€º á€™á€›á€¾á€­á€•á€«á‹ Admin Password á€™á€™á€¾á€”á€ºá€•á€«á‹';
                } else {
                    const error = await response.text();
                    statusDiv.style.color = 'red';
                    statusDiv.textContent = `âŒ á€¡á€™á€¾á€¬á€¸: ${error}`;
                }

            } catch (error) {
                statusDiv.style.color = 'red';
                statusDiv.textContent = `âŒ Network á€á€»á€­á€á€ºá€†á€€á€ºá€™á€¾á€¯ á€¡á€™á€¾á€¬á€¸: ${error.message}`;
            }
        }

        // -----------------------------------------------------------------
        // 3. Delete á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€º
        // -----------------------------------------------------------------
        async function deleteNote(id) {
            if (!confirm(`á€™á€¾á€á€ºá€…á€¯ ID: ${id} á€€á€­á€¯ á€–á€»á€€á€ºá€•á€…á€ºá€™á€¾á€¬ á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?`)) {
                return;
            }

            const adminKey = document.getElementById('admin-key').value;
            if (!adminKey) {
                alert("á€–á€»á€€á€ºá€›á€”á€ºá€¡á€á€½á€€á€º Admin Password á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«á‹");
                return;
            }

            statusDiv.textContent = `á€™á€¾á€á€ºá€…á€¯ ${id} á€€á€­á€¯ á€–á€»á€€á€ºá€”á€±á€•á€«á€á€Šá€ºá‹...`;
            
            try {
                const response = await fetch(`${API_URL}/notes/${id}`, {
                    method: 'DELETE',
                    headers: { 'X-Admin-Key': adminKey }
                });

                if (response.ok) {
                    statusDiv.style.color = 'green';
                    statusDiv.textContent = `âœ… á€™á€¾á€á€ºá€…á€¯ ${id} á€€á€­á€¯ á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€…á€½á€¬ á€–á€»á€€á€ºá€•á€…á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹`;
                    loadNotesForAdmin();
                } else if (response.status === 401) {
                    statusDiv.style.color = 'red';
                    statusDiv.textContent = 'âŒ á€–á€»á€€á€ºá€á€½á€„á€·á€º á€™á€›á€¾á€­á€•á€«á‹ Admin Password á€™á€™á€¾á€”á€ºá€•á€«á‹';
                } else {
                    const error = await response.text();
                    statusDiv.style.color = 'red';
                    statusDiv.textContent = `âŒ á€–á€»á€€á€ºá€›á€¬á€á€½á€„á€º á€¡á€™á€¾á€¬á€¸á€•á€±á€«á€ºá€•á€±á€«á€€á€ºá€•á€«á€á€Šá€º: ${error}`;
                }
            } catch (error) {
                statusDiv.style.color = 'red';
                statusDiv.textContent = `âŒ Network á€á€»á€­á€á€ºá€†á€€á€ºá€™á€¾á€¯ á€¡á€™á€¾á€¬á€¸: ${error.message}`;
            }
        }

        // -----------------------------------------------------------------
        // 4. Edit á€¡á€á€½á€€á€º Note Data á€€á€­á€¯ Form á€‘á€²á€á€­á€¯á€· á€‘á€Šá€·á€ºá€á€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸
        // -----------------------------------------------------------------
        function startEdit(noteData) {
            editingNoteId = noteData.id;
            
            document.getElementById('note-title').value = noteData.title;
            document.getElementById('note-category').value = noteData.category || 'General';
            document.getElementById('note-content').value = noteData.content;
            
            submitButton.textContent = 'á€™á€¾á€á€ºá€…á€¯ á€•á€¼á€„á€ºá€†á€„á€ºá€™á€Šá€º';
            cancelEditButton.style.display = 'inline-block';
            statusDiv.textContent = `á€™á€¾á€á€ºá€…á€¯ ID: ${noteData.id} á€€á€­á€¯ á€•á€¼á€„á€ºá€†á€„á€ºá€”á€±á€•á€«á€á€Šá€ºá‹`;
            
            // Form á€¡á€•á€±á€«á€ºá€á€­á€¯á€· á€›á€½á€¾á€±á€·á€á€¼á€„á€ºá€¸
            form.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Edit Cancel á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
        cancelEditButton.addEventListener('click', function() {
            editingNoteId = null;
            form.reset();
            submitButton.textContent = 'á€™á€¾á€á€ºá€…á€¯ á€á€„á€ºá€á€½á€„á€ºá€¸á€™á€Šá€º';
            cancelEditButton.style.display = 'none';
            statusDiv.textContent = '';
        });

        // -----------------------------------------------------------------
        // Event Listeners (Form Submit, Edit/Delete Buttons)
        // -----------------------------------------------------------------
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            handleNoteSubmission();
        });

        notesListContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-btn')) {
                deleteNote(e.target.dataset.id);
            } else if (e.target.classList.contains('edit-btn')) {
                // data-note attribute á€™á€¾ JSON string á€€á€­á€¯ object á€¡á€–á€¼á€…á€º á€•á€¼á€”á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€šá€°
                const noteData = JSON.parse(e.target.dataset.note); 
                startEdit(noteData);
            }
        });

        // á€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬ á€…á€á€Šá€ºá€”á€¾á€„á€·á€º Admin á€™á€¾á€á€ºá€…á€¯ á€…á€¬á€›á€„á€ºá€¸á€€á€­á€¯ á€…á€á€„á€º load á€•á€«
        document.addEventListener('DOMContentLoaded', loadNotesForAdmin); 
    </script>
</body>
</html>
