<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KP Blog Free Page</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <header>
        <div class="header-content">
            <div class="logo-and-title">
                <img src="images/logo.png" alt="KP Logo" class="logo"> 
                <h1 class="site-title">KP Blog</h1>
            </div>
            <nav>
    <a href="index.html">မူလစာမျက်နှာ</a>
    <a href="posts.html">Posts</a>
    <a href="free.html">Free</a> 
    <a href="buy.html">ဝယ်ယူရန်</a> 
</nav>

        </div>
    </header>

    <div class="intro-bar">
       
        
        <main>
        <section class="posts-section"> </section>
        <h1>KP WEBSITE FREE PAGE</h1>
        
        
            <div class="copy-box">
                <p class="copy-box-title">ကူးယူရန် စာသား:</p> 
                <textarea id="vmessContent" readonly class="vmess-textarea">vmess://eyJhZGRyZXNzIjoiMTY1LjIzM1...IinQ=</textarea>
                <button onclick="copyToClipboard('vmessContent')" class="copy-button">စာသား ကူးယူမည်</button>
            </div>
        </section>

        <section class="upload-section">
            <h2>ဖိုင်တင်ရန် နေရာ</h2>
            <p>ပုံများ၊ PDF များ သို့မဟုတ် သင်ကြိုက်နှစ်သက်သော ဖိုင်များကို ဤနေရာတွင် တင်နိုင်ပါသည်။</p>
            
            <div class="upload-container">
    <label for="r2FileInput" class="custom-file-upload">
        <span id="fileNameDisplay">Choose File</span>
        <input type="file" id="r2FileInput" onchange="updateFileName(this)"> 
    </label>

    <button onclick="startR2Upload()">
        <span>✔</span>
    </button>
    <div id="uploadMessage" class="upload-status-message">Upload status will appear here.</div>
</div>

        </section>

 <script>
    // Copy function အသစ် - elementId ကို လက်ခံသည်
    function copyToClipboard(elementId) {
        var copyText = document.getElementById(elementId);

        // textarea ထဲက စာသားကို ရွေးချယ်သည်
        copyText.select();
        copyText.setSelectionRange(0, 99999); 

        // စာသားကို ကူးယူသည်
        document.execCommand("copy");

        // ကူးယူမှု အခြေအနေကို ဖော်ပြသည် (သင့်ရဲ့ HTML မှာ <p id="copyStatus" class="copy-status"></p> ပါပြီးသားလို့ ယူဆပါတယ်)
        document.getElementById("copyStatus").innerText = "✔ စာသား ကူးယူပြီးပါပြီ!";

        // ၃ စက္ကန့်ကြာရင် Status ကို ပြန်ဖျောက်သည်
        setTimeout(function(){
            document.getElementById("copyStatus").innerText = "";
        }, 3000);
    }
    
    // ... အောက်မှာ တခြား JavaScript function တွေရှိပါက ဆက်ထားပါ...
</script>

            <script>
        // 1. Copy Function (vmessContent ID ကို သုံးပြီး ကူးယူရန်)
        function copyToClipboard(elementId) {
            var copyText = document.getElementById(elementId);
            copyText.select();
            copyText.setSelectionRange(0, 99999); 
            document.execCommand("copy");

            // Status ပြရန် (သင့်ရဲ့ HTML မှာ id="copyStatus" မပါသေးလျှင် ထည့်ပေးရမည်)
            // document.getElementById("copyStatus").innerText = "✔ စာသား ကူးယူပြီးပါပြီ!";
            // setTimeout(function(){
            //     document.getElementById("copyStatus").innerText = "";
            // }, 3000);
            alert("စာသား ကူးယူပြီးပါပြီ!"); // လွယ်ကူစေရန် alert သုံးသည်
        }

        // 2. File Name Display Function (File ရွေးပြီးတာနဲ့ နာမည်ပေါ်စေရန်)
        function updateFileName(input) {
            var fileName = input.files[0] ? input.files[0].name : "No file chosen";
            document.getElementById('fileNameDisplay').innerText = fileName;
        }

        // 3. R2 Upload Function (အဆင့် ၁ မှ Function ကို ခေါ်ရန်)
        function startR2Upload() {
            const fileInput = document.getElementById('r2FileInput');
            const uploadMessage = document.getElementById('uploadMessage');
            const file = fileInput.files[0];

            if (!file) {
                uploadMessage.innerHTML = '❌ ဖိုင်ကို ရွေးချယ်ပေးပါဦး။';
                return;
            }

            uploadMessage.innerText = 'ဖိုင်တင်နေပါသည်...'; 

            // ⚠️ Function Path ကို တိုက်ရိုက် ခေါ်ဆိုခြင်း (အဆင့် ၁ မှ Code နှင့် ကိုက်ညီသည်)
            // ... (free.html ထဲက startR2Upload function)

    // ⚠️ API Endpoint မှာ file.type ကို ထပ်ပို့ပါ
    const fileType = encodeURIComponent(file.type || 'application/octet-stream'); 
    const apiEndpoint = '/upload-url?fileName=' + file.name + '&fileType=' + fileType;

    fetch(apiEndpoint)
// ... (ကျန်တာ အတူတူပဲ ထားပါ)


            fetch(apiEndpoint)
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`API Call Failed. Status: ${response.status}. Response: ${text.substring(0, 50)}...`);
                        });
                    }
                    return response.json(); 
                })
                .then(data => {
                    const signedUrl = data.uploadURL; 
                    
                    // R2 သို့ ဖိုင်ကို တိုက်ရိုက် တင်ခြင်း (PUT Request)
                    return fetch(signedUrl, {
                        method: 'POST',
                        body: file,
                        headers: {
                            'Content-Type': file.type || 'application/octet-stream'
                        }
                    });
                })
                .then(uploadResponse => {
                    if (uploadResponse.ok) {
                        // 200 OK ရရင် အောင်မြင်သည်
                        uploadMessage.innerHTML = `✅ ဖိုင်ကို အောင်မြင်စွာ တင်ပြီးပါပြီ! (${file.name})`;
                    } else {
                        // R2 ကနေ Error (403 Forbidden, 400 Bad Request) ပြန်လာရင်
                        throw new Error(`R2 Upload Failed: ${uploadResponse.status} ${uploadResponse.statusText}`);
                    }
                })
                .catch(error => {
                    // Network Error သို့မဟုတ် API ချိတ်ဆက်မှု Error
                    console.error('Final Upload Error:', error);
                    uploadMessage.innerHTML = `❌ Upload မအောင်မြင်ပါ။ Error: ${error.message}`;
                });
        }
    </script>
</body>
</html>
