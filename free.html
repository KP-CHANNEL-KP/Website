<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KP Blog • Free Page</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

    <!-- OneSignal -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

    <!-- Ads & Analytics -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4159471269322022" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7F5VL62DT2"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-7F5VL62DT2');</script>
    <script type='text/javascript' src='//pl28057847.effectivegatecpm.com/34/23/c5/3423c58ebdd6e84dccf686ec977a84fa.js'></script>
    <script type='text/javascript' src='//pl28060126.effectivegatecpm.com/cd/7c/68/cd7c68b42eafa9811e9cc7f1074893b5.js'></script>
    <script src="https://my.rtmark.net/p.js?f=sync&lr=1&partner=2134cbd94e69258d0987ea05830383043f21608a1d7bf16e1948d0ec11354793" defer></script>

    <style>
        :root {
            --primary: #00ff9d;
            --bg: #0a0a1a;
            --card: rgba(20, 20, 40, 0.7);
            --text: #e0e0ff;
            --border: rgba(0, 255, 157, 0.3);
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Pyidaungsu', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 100%);
            color: var(--text);
            min-height: 100vh;
            background-attachment: fixed;
        }
        header {
            background: rgba(10,10,26,0.9);
            backdrop-filter: blur(12px);
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        .header-content {
            max-width: 1400px; margin: 0 auto; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo-and-title img { height: 50px; border-radius: 12px; }
        .site-title { color: var(--primary); font-size: 2em; margin-left: 12px; text-shadow: 0 0 15px var(--primary); }
        nav a {
            color: #fff; margin: 0 15px; text-decoration: none; font-weight: 500;
            transition: 0.3s; position: relative;
        }
        nav a:hover { color: var(--primary); }
        nav a::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -6px; left: 0; background: var(--primary); transition: 0.3s; }
        nav a:hover::after { width: 100%; }

        main { margin-top: 90px; padding: 20px; max-width: 1000px; margin-left: auto; margin-right: auto; }

        .glass-card {
            background: var(--card);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid var(--border);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:none; } }

        h1, h2 { color: var(--primary); text-align: center; margin-bottom: 20px; text-shadow: 0 0 10px rgba(0,255,157,0.5); }

        textarea#mainTextArea {
            width: 100%; height: 450px; background: rgba(0,0,0,0.4);
            border: 1px solid var(--border); border-radius: 15px;
            padding: 15px; color: #fff; font-size: 1em;
            resize: none; backdrop-filter: blur(5px);
        }

        .btn {
            background: var(--primary); color: #000; border: none; padding: 14px 28px;
            border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.1em;
            transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,255,157,0.4);
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,255,157,0.6); }

        .upload-container {
            display: flex; gap: 15px; align-items: center; flex-wrap: wrap;
        }
        .custom-file-upload {
            background: rgba(0,255,157,0.15); border: 2px dashed var(--primary);
            padding: 15px 30px; border-radius: 50px; cursor: pointer; transition: 0.3s;
        }
        .custom-file-upload:hover { background: rgba(0,255,157,0.3); }

        #notificationPrompt {
            background: linear-gradient(135deg, #fff1f1, #ffeaea);
            border: 3px solid #ff4d4d; border-radius: 20px; padding: 20px;
            text-align: center; box-shadow: 0 10px 30px rgba(255,77,77,0.3);
        }

        footer { text-align: center; padding: 30px; color: #777; margin-top: 50px; }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <div class="logo-and-title">
            <img src="images/logo.png" alt="KP Logo">
            <h1 class="site-title">KP Blog</h1>
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="posts.html">Posts</a>
            <a href="free.html">Free</a>
            <a href="buy.html">Buy</a>
            <a href="All.html">All</a>
            <a href="Privacy Policy.html">Privacy</a>
            <a href="contact.html">Contact</a>
            <a href="About.html">About</a>
            <a href="guides.html">Guides</a>
            <a href="chat.html">Chat Group</a>
        </nav>
    </div>
</header>

<main>
    <div class="glass-card">
        <h1>KP WEBSITE • FREE PAGE</h1>

        <!-- Push Notification Prompt -->
        <div id="notificationPrompt" style="display:none;">
            <p style="font-size:1.4em; font-weight:bold; color:#e53e3e;">
                ✨ အရေးပေါ် Update လက်မလွတ်ရအောင် Allow ပေးပါ ✨
            </p>
            <button class="btn" id="allowButton" onclick="showNotificationPrompt()">Allow လုပ်မည်</button>
        </div>

        <!-- Main Text Area -->
        <textarea id="mainTextArea" readonly>ဒေတာများကို စတင်ဆွဲယူနေပါသည်။</textarea>

        <!-- Admin Gate -->
        <div id="adminPasswordGate" class="glass-card" style="margin-top:20px;">
            <input type="password" id="adminTextPwInput" placeholder="Admin Password" style="width:100%; padding:15px; border-radius:15px; border:none; background:rgba(0,0,0,0.4); color:#fff; margin-bottom:10px;">
            <button class="btn" onclick="checkAdminPassword()">စာတင်ခွင့် ရယူမည်</button>
            <p id="pwMessage" style="color:#ff6b6b; display:none;">Password မှားနေပါသည်။</p>
        </div>

        <div id="textAdminPanel" style="display:none; margin-top:20px;">
            <input type="text" id="inputLine" placeholder="စာအသစ်ရိုက်ထည့်ပါ..." style="width:100%; padding:15px; border-radius:15px; border:none; background:rgba(0,0,0,0.4); color:#fff; margin-bottom:10px;">
            <button class="btn" onclick="copyMainTextToClipboard()">ကူးယူမည်</button>
            <button class="btn" id="saveButton" onclick="saveToMainTextarea()">Save လုပ်မည်</button>
        </div>
    </div>

    <!-- Upload Section -->
    <div class="glass-card">
        <h2>ဖိုင်တင်ရန် နေရာ</h2>
        <div class="upload-container">
            <label for="fileInput" class="custom-file-upload"><span id="fileNameDisplay">Choose File</span></label>
            <input type="file" id="fileInput" onchange="updateFileName(this)" hidden>
            <button class="btn" onclick="startR2Upload()">Upload</button>
        </div>
        <div id="uploadMessage" style="margin-top:15px; text-align:center; font-weight:bold;"></div>
    </div>

    <!-- Download Button -->
    <div class="glass-card" style="text-align:center;">
        <h2>⬇️ ဖိုင်ဒေါင်းလုတ်ရယူရန်</h2>
        <a href="#" onclick="showFiles()" class="btn" style="font-size:1.5em; padding:20px 50px;">DOWNLOAD</a>
        <p id="file-list-message" style="display:none; margin-top:20px; color:var(--primary);">File များကို Download လုပ်ရန် အသင့်ဖြစ်ပါပြီ။</p>
        <iframe id="r2-file-list-iframe" src="/api/r2-list" style="width:100%; min-height:500px; border-radius:15px; margin-top:20px; display:none;" frameborder="0"></iframe>
    </div>
</main>

<footer>© 2025 KP Blog • All Rights Reserved</footer>

<!-- အရင်ရှိတဲ့ JS အားလုံး ဒီထဲမှာ ပါပြီးသား -->
<script>
    // OneSignal + အရင် JS အားလုံး ဒီထဲမှာ အတိုင်းအတာ ပါတယ်
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
        await OneSignal.init({appId: "3c47c69a-ea04-40e8-807a-e779477f067f"});
        OneSignal.isPushNotificationsEnabled(isEnabled => {
            if (!isEnabled) document.getElementById('notificationPrompt').style.display = 'block';
        });
    });
    function showNotificationPrompt() {
        window.OneSignalDeferred.push(OneSignal => OneSignal.showNativePrompt());
        document.getElementById('notificationPrompt').style.display = 'none';
    }

    const ADMIN_TEXT_PASSWORD = "232003";
    function checkAdminPassword() {
        if (document.getElementById('adminTextPwInput').value === ADMIN_TEXT_PASSWORD) {
            document.getElementById('adminPasswordGate').style.display = 'none';
            document.getElementById('textAdminPanel').style.display = 'block';
        } else document.getElementById('pwMessage').style.display = 'block';
    }
    function showFiles() {
        document.getElementById('r2-file-list-iframe').style.display = 'block';
        document.getElementById('file-list-message').style.display = 'block';
    }
    function updateFileName(e) { document.getElementById('fileNameDisplay').innerText = e.files[0].name; }
    async function startR2Upload() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) return document.getElementById('uploadMessage').innerHTML = 'ဖိုင်ရွေးပါ';
        const form = new FormData(); form.append('file', file);
        const res = await fetch('/api/upload', {method:'POST', body:form});
        const json = await res.json();
        document.getElementById('uploadMessage').innerHTML = json.status === 'SUCCESS' ? 'Upload အောင်မြင်ပါပြီ!' : 'Upload မအောင်မြင်ပါ';
        if (json.status === 'SUCCESS') document.getElementById('r2-file-list-iframe').src += '';
    }
    async function fetchInitialText() {
        const res = await fetch('/api/text');
        document.getElementById('mainTextArea').value = await res.text();
    }
    async function saveToMainTextarea() {
        const newText = document.getElementById('inputLine').value.trim();
        if (!newText) return alert('စာရိုက်ပါ');
        const timestamp = new Date().toLocaleString();
        const updated = `[\( {timestamp}]\n\n \){newText}\n\n============================\n\n` + document.getElementById('mainTextArea').value;
        await fetch('/api/text', {method:'POST', body:updated, headers:{'Content-Type':'text/plain'}});
        document.getElementById('mainTextArea').value = updated;
        document.getElementById('inputLine').value = '';
        alert('သိမ်းပြီးပါပြီ!');
    }
    function copyMainTextToClipboard() {
        navigator.clipboard.writeText(document.getElementById('mainTextArea').value).then(()=>alert('ကူးပြီးပါပြီ!'));
    }
    document.addEventListener('DOMContentLoaded', fetchInitialText);
</script>
</body>
</html>
