<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KP Top Up â€¢ Login á€á€„á€ºá€•á€±á€¸á€•á€«á€á€™á€»á‹ğŸ¥°</title>
    <meta name="google-signin-client_id" content="745888739692-gq8h4f6tjcr35d7ttmce4vg6d03of5tp.apps.googleusercontent.com">
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root{--p:#00ff9d;--pd:#00cc7a;--bg:#0d0d1f;--c:rgba(20,25,50,0.9);--t:#e0e0ff;--b:rgba(0,255,157,0.3);}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Pyidaungsu',sans-serif;background:linear-gradient(135deg,#0d0d1f,#1a1a2e);color:var(--t);min-height:100vh;display:flex;align-items:center;justify-content:center;background-attachment:fixed;}
        .login-box{background:var(--c);backdrop-filter:blur(15px);border-radius:20px;padding:40px;width:90%;max-width:420px;text-align:center;border:1px solid var(--b);box-shadow:0 20px 50px rgba(0,0,0,0.6);}
        .logo img{height:90px;border-radius:20px;border:4px solid var(--p);margin-bottom:20px;box-shadow:0 0 30px rgba(0,255,157,0.6);}
        h1{font-size:2.8em;background:linear-gradient(90deg,#00ff9d,#00ccff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:15px 0 25px;}
        p{font-size:1.15em;margin:20px 0;color:#ccc;}
        .hidden{display:none !important;}
        footer{position:fixed;bottom:15px;left:0;right:0;text-align:center;color:#666;font-size:0.9em;}
    </style>
</head>
<body>

<div class="login-box" id="loginBox">
    <div class="logo"><img src="images/logo.png" alt="KP Logo"></div>
    <h1>KP Top Up</h1>
    <p>á€œá€¯á€¶á€á€¼á€¯á€¶á€…á€­á€á€ºá€á€»á€…á€½á€¬ á€á€šá€ºá€šá€°á€”á€­á€¯á€„á€ºá€•á€«á€á€šá€º á€á€™á€»á‹ğŸ˜<br><strong style="color:var(--p);">Google á€–á€¼á€„á€·á€º Login á€á€„á€ºá€•á€±á€¸á€•á€« á€á€™á€»á‹ğŸ¤“</strong></p>
    <div id="googleSignIn" style="margin:35px auto;"></div>
    <p style="color:#ff6b6b;font-size:0.95em;">á€™á€„á€ºá€¹á€‚á€œá€¬ á€¡á€•á€±á€«á€„á€ºá€¸á€”á€²á€· á€•á€¼á€Šá€ºá€·á€…á€¯á€¶á€•á€«á€…á€±á€œá€­á€¯á€· KP á€™á€¾á€”á€¾á€¯á€á€ºá€á€½á€”á€ºá€¸á€†á€€á€ºá€á€•á€«á€á€Šá€ºá‹ğŸ˜‰!</p>
</div>

<div id="topupPage" class="hidden"></div>
<footer>Â© KP TOP UP â€¢ á€¡á€œá€¯á€¶á€á€¼á€¯á€¶á€†á€­á€¯á€¸ á€”á€²á€· á€¡á€œá€»á€¾á€„á€ºá€™á€¼á€”á€ºá€†á€¯á€¶á€¸</footer>

<script>
const GOOGLE_CLIENT_ID = "745888739692-gq8h4f6tjcr35d7ttmce4vg6d03of5tp.apps.googleusercontent.com";
let currentUser = null;

// === BAN SYSTEM (UPDATED WITH WORKER KV CHECK) ===

// ğŸ”‘ á€á€á€ºá€™á€¾á€á€ºá€‘á€¬á€¸á€á€±á€¬ Worker URL
const BAN_CHECK_WORKER_URL = "https://salebotban.kponly.ggff.net";

async function checkBanned(){
    if (!currentUser || !currentUser.id) return false;

    try{
        // Worker á€™á€¾ /check-ban/ á€€á€­á€¯ á€á€±á€«á€ºá€šá€°á€•á€¼á€®á€¸ á€œá€€á€ºá€›á€¾á€­ User ID á€€á€­á€¯ á€…á€…á€ºá€†á€±á€¸á€á€Šá€ºá‹
        const r = await fetch(`${BAN_CHECK_WORKER_URL}/check-ban/${currentUser.id}`);
        const result = await r.json();

        if(result.banned){
            // Ban á€á€¶á€‘á€¬á€¸á€›á€•á€«á€€ HTML á€€á€­á€¯ á€¡á€±á€¬á€€á€ºá€•á€«á€¡á€á€­á€¯á€„á€ºá€¸ á€¡á€…á€¬á€¸á€‘á€­á€¯á€¸á€á€Šá€ºá‹
            document.body.innerHTML = `
            <div style="text-align:center;margin-top:150px;padding:40px;">
                <h1 style="font-size:3em;color:#ff6b6b;">á€¡á€€á€±á€¬á€„á€·á€º Ban á€œá€­á€¯á€€á€ºá€•á€«á€•á€® á€‚á€±á€«á€„á€ºá€¸á€›á€®á€¸ğŸ˜‚</h1>
                <p style="font-size:1.5em;color:white;margin:30px;">á€á€„á€ºá€Ÿá€¬ á€á€€á€šá€º á€á€šá€ºá€á€¬á€œá€²á€™á€Ÿá€¯á€á€ºá€•á€²á€”á€²á€· á€œá€€á€ºá€á€¡á€¬á€¸ á€šá€¬á€¸á€”á€±á€œá€­á€¯á€·á€•á€«ğŸ¤£á‹</p>
                <p style="color:#aaa;">á€•á€¼á€”á€ºá€¡á€á€”á€¬á€¸á€á€¶á€›á€”á€º: @KPBYKP</p>
            </div>`;
            return true;
        }
    }catch(e){
        // Worker URL á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€á€¼á€„á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º connection error á€›á€¾á€­á€›á€„á€º console á€‘á€²á€™á€¾á€¬ Error á€•á€¼á€™á€Šá€º
        console.log("Ban list á€…á€…á€ºá€›á€¬á€á€½á€„á€º Error á€›á€¾á€­á€•á€«á€á€Šá€º (Worker URL á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º KV á€á€»á€­á€á€ºá€†á€€á€ºá€™á€¾á€¯á€…á€…á€ºá€•á€«):", e);
    }
    return false;
}
// === END BAN SYSTEM ===


function decodeJwt(t){
    try{
        let b = t.split('.')[1].replace(/-/g,'+').replace(/_/g,'/');
        let p = decodeURIComponent(atob(b).split('').map(c=>'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join(''));
        return JSON.parse(p);
    }catch(e){return null;}
}

window.handleCredentialResponse = async function(r){
    const p = decodeJwt(r.credential);
    if(!p || !p.email){
        alert("Google Sign In á€™á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€•á€«á‹ á€‘á€•á€ºá€…á€™á€ºá€¸á€€á€¼á€Šá€·á€ºá€•á€«á‹");
        return;
    }
    currentUser = {name:p.name, email:p.email, id:p.sub, photo:p.picture};

    if(await checkBanned()) return;

    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("topupPage").classList.remove("hidden");
    loadTopUpPage();
};

function loadTopUpPage(){
    document.getElementById("topupPage").innerHTML = `
    <header style="position:fixed;top:0;left:0;right:0;background:rgba(10,10,30,0.98);backdrop-filter:blur(20px);z-index:1000;padding:12px 20px;border-bottom:1px solid var(--b);">
        <div style="max-width:1400px;margin:auto;display:flex;align-items:center;justify-content:space-between;">
            <div style="display:flex;align-items:center;gap:15px;">
                <img src="${currentUser.photo}" width="52" height="52" style="border-radius:50%;border:3px solid var(--p);box-shadow:0 0 20px rgba(0,255,157,0.6);">
                <div>
                    <div style="font-weight:bold;color:var(--p);font-size:1.3em;">${currentUser.name}</div>
                    <div style="font-size:0.9em;color:#aaa;">${currentUser.email}</div>
                </div>
            </div>
            <div style="color:#ff6b6b;background:rgba(255,107,107,0.15);padding:8px 15px;border-radius:12px;font-weight:bold;">á€á€šá€ºá€šá€°á€á€Šá€ºá€· á€•á€…á€¹á€…á€Šá€ºá€¸á€™á€»á€¬á€¸á€€á€­á€¯ á€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬ á€–á€¼á€Šá€ºá€·á€…á€½á€€á€º á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«</div>
        </div>
    </header>

    <main style="margin-top:90px;padding:20px;max-width:1000px;margin:auto;">
        <h1 style="text-align:center;font-size:3.2em;margin:20px 0;background:linear-gradient(90deg,#00ff9d,#00ccff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 0 30px rgba(0,255,157,0.4);">KP Top Up Center</h1>

        <div style="background:var(--c);backdrop-filter:blur(15px);border-radius:25px;padding:35px;border:1px solid var(--b);box-shadow:0 20px 50px rgba(0,0,0,0.5);">
            <label style="font-size:1.3em;color:var(--p);">á€‚á€­á€™á€ºá€¸á€›á€½á€±á€¸á€•á€«</label>
            <select id="game" style="width:100%;padding:16px;margin:15px 0;border-radius:15px;border:1px solid var(--b);background:rgba(10,15,35,0.9);color:white;font-size:1.1em;">
                <option value="pubg">PUBG Mobile</option>
                <option value="ml">Mobile Legends</option>
                <option value="@@">@@</option>
            </select>

            <label style="font-size:1.3em;color:var(--p);">User ID</label>
            <input type="text" id="userId" placeholder="MLBB DM á€á€šá€ºá€œá€»á€¾á€„á€º ZONE ID á€•á€« á€‘á€Šá€ºá€·á€•á€±á€¸á€•á€«á‹(á€¥á€•á€™á€¬: 123456789 (1234)" oninput="this.value=this.value.replace(/[^\\d()]/g,'')" style="width:100%;padding:16px;margin:15px 0;border-radius:15px;border:1px solid var(--b);background:rgba(10,15,35,0.9);color:white;font-size:1.1em;">

            <label style="font-size:1.3em;color:var(--p);">á€„á€½á€±á€œá€½á€¾á€²á€•á€¼á€±á€…á€¬ á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸ á… á€œá€¯á€¶á€¸</label>
            <input type="text" id="refNumber" maxlength="7" placeholder="á€¥á€•á€™á€¬: 12345" oninput="this.value=this.value.replace(/[^\\d()]/g,'')" style="width:100%;padding:16px;margin:15px 0;border-radius:15px;border:1px solid var(--b);background:rgba(10,15,35,0.9);color:white;font-size:1.1em;letter-spacing:6px;font-weight:bold;">

            <div style="text-align:center;margin:30px 0;font-size:1.5em;color:var(--p);">
                <span id="gameName">PUBG Mobile</span> á€¡á€á€½á€€á€º á€•á€™á€¬á€ á€›á€½á€±á€¸á€•á€«
            </div>

            <div id="packages" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin:35px 0;"></div>

            <div style="display:flex;justify-content:center;gap:40px;margin:40px 0;flex-wrap:wrap;">
                <div class="pay active" data-pay="wave"><img src="images/wave.png" width="90" height="90" style="border-radius:20px;border:4px solid var(--p);box-shadow:0 0 25px rgba(0,255,157,0.7);"><br><span style="font-weight:bold;">Wave Pay</span></div>
                <div class="pay" data-pay="kpay"><img src="images/kpay.png" width="90" height="90" style="border-radius:20px;border:4px solid transparent;"><br><span style="font-weight:bold;">KPay</span></div>
            </div>

            <div style="text-align:center;margin:30px 0;color:#ff6b6b;font-size:1.3em;background:rgba(255,107,107,0.15);padding:15px;border-radius:15px;">
                á€„á€½á€±á€œá€½á€¾á€²á€•á€¼á€®á€¸á€™á€¾ á€¡á€±á€¬á€€á€ºá€€ á€™á€¾á€¬á€šá€°á€™á€Šá€º á€”á€¾á€­á€•á€ºá€•á€«<br>
                <strong style="font-size:1.4em;color:var(--p);">Wave/KPay: 09966955081</strong>
            </div>

            <button onclick="submitOrder()" style="width:100%;padding:22px;background:linear-gradient(45deg,var(--p),var(--pd));color:black;font-weight:bold;font-size:1.7em;border-radius:50px;border:none;cursor:pointer;box-shadow:0 15px 40px rgba(0,255,157,0.6);">
                á€™á€¾á€¬á€šá€°á€™á€Šá€º
            </button>
            <button id="loadingBtn" style="display:none;width:100%;padding:22px;background:#444;color:white;font-size:1.7em;border-radius:50px;" disabled>á€•á€­á€¯á€·á€”á€±á€•á€«á€á€Šá€º...</button>
        </div>
    </main>`;

    const packages = {pubg:[{name:"ğŸ’¸60 UC",price:"3800 á€€á€»á€•á€º"},{name:"ğŸ’¸325 UC",price:"18000 á€€á€»á€•á€º"},{name:"ğŸ’¸660 UC",price:"35800 á€€á€»á€•á€º"},{name:"ğŸ’¸1800 UC",price:"89300 á€€á€»á€•á€º"},{name:"ğŸ’¸3850 UC",price:"177800 á€€á€»á€•á€º"},{name:"ğŸ’¸8100 UC",price:"360300 á€€á€»á€•á€º"}],
        ml:[{name:"ğŸ’86 Diamonds",price:"4900 á€€á€»á€•á€º"},{name:"ğŸ’172 Diamonds",price:"9600 á€€á€»á€•á€º"},{name:"ğŸ’257 Diamonds",price:"14100 á€€á€»á€•á€º"},{name:"ğŸ’344 Diamonds",price:"18700 á€€á€»á€•á€º"},{name:"ğŸ’429 Diamonds",price:"23700 á€€á€»á€•á€º"},{name:"ğŸ’Weekly Pass",price:"6000 á€€á€»á€•á€º"}],
        @@:[{name:"@@",price:"@@ á€€á€»á€•á€º"},{name:"@@",price:"@@ á€€á€»á€•á€º"},{name:"@@",price:"@@ á€€á€»á€•á€º"},{name:"@@",price:"@@ á€€á€»á€•á€º"},{name:"@@",price:"@@ á€€á€»á€•á€º"},{name:"@@",price:"@@ á€€á€»á€•á€º"}]};
    let selectedPkg = packages.pubg[0];
    let selectedPay = "wave";

    function loadPackages(){
        const game = document.getElementById("game").value;
        document.getElementById("gameName").textContent = game==="pubg"?"PUBG Mobile":"Mobile Legends":"@@";
        const c = document.getElementById("packages"); c.innerHTML="";
        packages[game].forEach((p,i)=>{
            const d=document.createElement("div");
            d.className="pkg"+(i===0?" active":"");
            
            // ğŸ”‘ á€•á€¼á€„á€ºá€†á€„á€ºá€á€»á€€á€º á: Template Literal Syntax á€€á€­á€¯ á€™á€¾á€”á€ºá€€á€”á€ºá€¡á€±á€¬á€„á€º á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸
            d.innerHTML=`<h3>${p.name}</h3><p>${p.price}</p>`; 
            
            d.style.cssText="background:rgba(0,255,157,0.15);border:3px solid var(--p);border-radius:18px;padding:25px;text-align:center;cursor:pointer;transition:0.4s;";
            if(i===0) d.style.cssText+="background:var(--p);color:#000;transform:translateY(-12px);box-shadow:0 15px 35px rgba(0,255,157,0.5);";
            d.onclick=()=>{document.querySelectorAll(".pkg").forEach(e=>e.style.cssText="background:rgba(0,255,157,0.15);border:3px solid var(--p);border-radius:18px;padding:25px;text-align:center;cursor:pointer;transition:0.4s;");d.style.cssText="background:var(--p);color:#000;transform:translateY(-12px);box-shadow:0 15px 35px rgba(0,255,157,0.5);border:3px solid var(--p);border-radius:18px;padding:25px;text-align:center;cursor:pointer;transition:0.4s;";selectedPkg=p;};
            c.appendChild(d);
        });
    }
    loadPackages();
    document.getElementById("game").onchange=loadPackages;

    document.querySelectorAll(".pay").forEach(p=>{
        p.onclick=()=>{
            document.querySelectorAll(".pay img").forEach(img=>img.style="border-radius:20px;border:4px solid transparent;");
            p.querySelector("img").style="border-radius:20px;border:4px solid var(--p);box-shadow:0 0 25px rgba(0,255,157,0.7);";
            document.querySelectorAll(".pay").forEach(e=>e.classList.remove("active"));
            
            // ğŸ”‘ á€•á€¼á€„á€ºá€†á€„á€ºá€á€»á€€á€º á‚: Typo á€€á€­á€¯ p (Element) á€¡á€–á€¼á€…á€º á€•á€¼á€„á€ºá€†á€„á€ºá€á€¼á€„á€ºá€¸
            p.classList.add("active"); 
            
            selectedPay=p.dataset.pay;
        };
    });

    window.submitOrder = async function(){
        let u = document.getElementById("userId").value.trim();
        let r = document.getElementById("refNumber").value.trim();
        if(!u.replace(/[()]/g,"") || !selectedPkg || r.replace(/[()]/g,"").length!==5){
            alert("á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬ á€–á€¼á€Šá€·á€ºá€•á€«á‹"); return;
        }
        document.querySelector("button[onclick='submitOrder()']").style.display="none";
        document.getElementById("loadingBtn").style.display="block";

        const msg = `*KP Top Up á€™á€¾á€¬á€šá€°á€™á€¾á€¯ á€¡á€á€…á€º*

*á€á€šá€ºá€á€°á€¡á€á€»á€€á€ºá€¡á€œá€€á€º*
á€¡á€™á€Šá€º: ${currentUser.name}
á€¡á€®á€¸á€™á€±á€¸á€œá€º: ${currentUser.email}
Google ID (Ban á€œá€¯á€•á€ºá€›á€”á€º): ${currentUser.id}

á€‚á€­á€™á€ºá€¸: ${document.getElementById("game").options[document.getElementById("game").selectedIndex].text}
User ID: ${u}
á€•á€™á€¬á€: ${selectedPkg.name}
á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸: ${selectedPkg.price}
á€„á€½á€±á€•á€±á€¸á€á€»á€±á€”á€Šá€ºá€¸: ${selectedPay==="wave"?"Wave Pay":"KPay"}
á€„á€½á€±á€œá€½á€¾á€²á€•á€¼á€±á€…á€¬ á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸ á… á€œá€¯á€¶á€¸: ${r}

á€¡á€á€»á€­á€”á€º: ${new Date().toLocaleString("my-MM")}`;

        try{
            await fetch("https://api.telegram.org/bot8378552045:AAEoXs-wPrjIQdWMj3WkO42GLwboyjR95-U/sendMessage",{
                method:"POST",headers:{"Content-Type":"application/json"},
                body:JSON.stringify({chat_id:7070690379,text:msg,parse_mode:"Markdown"})
            });
            alert("ğŸ¥³á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€…á€½á€¬ á€•á€±á€¸á€•á€­á€¯á€·á€•á€®á€¸á€•á€«á€•á€®!ğŸ¥³\nğŸ˜˜KP á€™á€¾ (áá€á€™á€­á€”á€…á€º)á€¡á€á€½á€„á€ºá€¸ á€‘á€Šá€·á€ºá€•á€±á€¸á€•á€«á€™á€Šá€ºá‹ğŸ˜˜");
        }catch(e){alert("á€¡á€„á€ºá€á€¬á€”á€€á€ºá€•á€¼á€¿á€”á€¬ á€›á€¾á€­á€”á€±á€•á€«á€á€Šá€ºá‹");}

        document.querySelector("button[onclick='submitOrder()']").style.display="block";
        document.getElementById("loadingBtn").style.display="none";
    };
}

window.onload = () => {
    google.accounts.id.initialize({client_id: GOOGLE_CLIENT_ID, callback: handleCredentialResponse});
    google.accounts.id.renderButton(document.getElementById("googleSignIn"),
        {theme:"outline", size:"large", text:"signin_with", width:"320", logo_alignment:"left"}
    );
    google.accounts.id.prompt();
};
</script>
</body>
</html>
