<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KP Top Up • Login လိုအပ်ပါသည်</title>
    <meta name="description" content="KP Top Up - Google ဖြင့် ဝင်ရောက်ပြီး လုံခြုံစိတ်ချစွာ ဝယ်ယူပါ">

    <meta name="google-signin-client_id" content="745888739692-gq8h4f6tjcr35d7ttmce4vg6d03of5tp.apps.googleusercontent.com">
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        :root {--primary:#00ff9d;--primary-dark:#00cc7a;--bg:#0d0d1f;--card:rgba(20,25,50,0.8);--text:#e0e0ff;--border:rgba(0,255,157,0.3);}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Pyidaungsu',sans-serif;background:linear-gradient(135deg,#0d0d1f,#1a1a2e);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;background-attachment:fixed;}
        .login-box{background:var(--card);backdrop-filter:blur(15px);border-radius:20px;padding:40px;width:90%;max-width:420px;text-align:center;border:1px solid var(--border);box-shadow:0 20px 50px rgba(0,0,0,0.6);}
        .logo img{height:80px;border-radius:20px;border:3px solid var(--primary);margin-bottom:20px;}
        h1{font-size:2.5em;background:linear-gradient(90deg,#00ff9d,#00ccff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px;}
        p{font-size:1.1em;margin:20px 0;color:#bbb;}
        .google-btn{margin:30px auto;width:80%;}
        .hidden{display:none;}
        footer{position:fixed;bottom:20px;color:#666;font-size:0.9em;left:0;right:0;text-align:center;}
    </style>
</head>
<body>

<div class="login-box" id="loginBox">
    <div class="logo"><img src="images/logo.png" alt="KP Logo"></div>
    <h1>KP Top Up</h1>
    <p>လုံခြုံစိတ်ချစွာ ဝယ်ယူရန်<br><strong>Google ဖြင့် ဝင်ရောက်ပါ</strong></p>
    <div id="googleSignIn" class="google-btn"></div>
    <p style="margin-top:30px;color:#ff6b6b;font-size:0.95em;">လိမ်ညာသူများကို ချက်ချင်း Ban လုပ်ပါမည်!</p>
</div>

<div id="topupPage" class="hidden"></div>

<footer>© 2025 KP Blog • လုံခြုံရေး အမြင့်ဆုံး</footer>

<script>
const GOOGLE_CLIENT_ID = "745888739692-gq8h4f6tjcr35d7ttmce4vg6d03of5tp.apps.googleusercontent.com";
let currentUser = null;

function onSignIn(googleUser) {
    // Note: getBasicProfile() is deprecated for GSI, but still functions for now.
    // In a real app, use the credential response object for user data.
    const profile = googleUser.getBasicProfile ? googleUser.getBasicProfile() : null;
    
    if (!profile) {
        console.error("Sign-in failed or profile not available.");
        alert("Google Sign In မအောင်မြင်ပါ၊ Console ကိုစစ်ဆေးပါ။");
        return;
    }

    currentUser = {
        name: profile.getName(),
        email: profile.getEmail(),
        id: profile.getId(),
        photo: profile.getImageUrl()
    };

    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("topupPage").classList.remove("hidden");
    loadTopUpPage();
}

function loadTopUpPage() {
    document.getElementById("topupPage").innerHTML = `
    <header style="position:fixed;top:0;left:0;right:0;background:rgba(10,10,30,0.95);backdrop-filter:blur(15px);z-index:1000;padding:15px 20px;border-bottom:1px solid var(--border);">
        <div style="max-width:1400px;margin:auto;display:flex;align-items:center;justify-content:space-between;">
            <div style="display:flex;align-items:center;gap:15px;">
                <img src="${currentUser.photo}" width="50" height="50" style="border-radius:50%;border:3px solid var(--primary);">
                <div style="color:white;">
                    <div style="font-weight:bold;color:var(--primary);">${currentUser.name}</div>
                    <div style="font-size:0.9em;color:#aaa;">${currentUser.email}</div>
                </div>
            </div>
            <div style="color:#ff6b6b;font-size:0.9em;">လိမ်ညာပါက ချက်ချင်း Ban လုပ်ပါမည်</div>
        </div>
    </header>

    <main style="margin-top:100px;padding:20px;max-width:1000px;margin:auto;">
        <h1 style="text-align:center;font-size:3em;margin:30px 0;background:linear-gradient(90deg,#00ff9d,#00ccff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">KP Top Up Center</h1>

        <div style="background:var(--card);backdrop-filter:blur(12px);border-radius:20px;padding:30px;border:1px solid var(--border);box-shadow:0 15px 40px rgba(0,0,0,0.4);">
            <label>ဂိမ်းရွေးပါ</label>
            <select id="game"><option value="pubg">PUBG Mobile</option><option value="ml">Mobile Legends</option></select>

            <label>User ID (နံပါတ် သို့မဟုတ် (နံပါတ်))</label>
            <input type="text" id="userId" placeholder="ဥပမာ: 5123456789 သို့မဟုတ် (5123456789)" oninput="this.value=this.value.replace(/[^\\d()]/g,'')">

            <label>ငွေလွှဲပြေစာ နောက်ဆုံး ၅ လုံး</label>
            <input type="text" id="refNumber" maxlength="7" placeholder="ဥပမာ: 54321 သို့မဟုတ် (54321)" oninput="this.value=this.value.replace(/[^\\d()]/g,'')" style="letter-spacing:5px;font-weight:bold;">

            <div style="font-size:1.3em;margin:25px 0;color:var(--primary);text-align:center;">
                <span id="gameName">PUBG Mobile</span> အတွက် ပမာဏ ရွေးပါ
            </div>

            <div id="packages" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin:30px 0;"></div>

            <div style="display:flex;justify-content:center;gap:30px;margin:30px 0;flex-wrap:wrap;">
                <div class="pay active" data-pay="wave" style="text-align:center;cursor:pointer;">
                    <img src="images/wave.png" width="80" height="80" style="border-radius:15px;border:3px solid var(--primary);"><br>Wave Pay
                </div>
                <div class="pay" data-pay="kpay" style="text-align:center;cursor:pointer;">
                    <img src="images/kpay.png" width="80" height="80" style="border-radius:15px;border:3px solid transparent;"><br>KPay
                </div>
            </div>

            <div style="text-align:center;margin:20px 0;color:#ff6b6b;font-size:1.2em;">
                ငွေလွှဲပြီးမှ အောက်က ခလုပ်ကို နှိပ်ပါ<br>
                <strong>Wave/KPay: 09966955081</strong>
            </div>

            <button onclick="submitOrder()" style="width:100%;padding:20px;background:linear-gradient(45deg,var(--primary),var(--primary-dark));color:black;font-weight:bold;font-size:1.5em;border-radius:50px;border:none;cursor:pointer;box-shadow:0 10px 30px rgba(0,255,157,0.5);">
                အတည်ပြုပြီး မှာယူမည်
            </button>
            <button id="loadingBtn" style="display:none;width:100%;padding:20px;background:#555;color:white;font-size:1.5em;border-radius:50px;border:none;" disabled>ပို့နေပါသည်...</button>
        </div>
    </main>`;

    // Packages & Submit Logic
    const packages = {pubg:[{name:"60 UC",price:"1000 ကျပ်"},{name:"325 UC",price:"5000 ကျပ်"},{name:"600 UC",price:"9000 ကျပ်"},{name:"1800 UC",price:"25000 ကျပ်"},{name:"3850 UC",price:"50000 ကျပ်"}],
        ml:[{name:"86 Diamonds",price:"3000 ကျပ်"},{name:"172 Diamonds",price:"5500 ကျပ်"},{name:"257 Diamonds",price:"8000 ကျပ်"},{name:"344 Diamonds",price:"10500 ကျပ်"},{name:"706 Diamonds",price:"21000 ကျပ်"}]};
    let selectedPkg = packages[document.getElementById("game").value][0]; // Initial selection
    let selectedPay = "wave";

    function loadPackages() {
        const game = document.getElementById("game").value;
        document.getElementById("gameName").textContent = game === "pubg" ? "PUBG Mobile" : "Mobile Legends";
        const container = document.getElementById("packages");
        container.innerHTML = "";
        
        const currentPackages = packages[game];

        currentPackages.forEach((p,i)=>{
            const div = document.createElement("div");
            div.className = "pkg"+(i===0?" active":"");
            
            // FIX: Template Literal Syntax မှန်ကန်နေပြီ
            div.innerHTML = `<h3>${p.name}</h3><p>${p.price}</p>`; 
            
            div.style.cssText = "background:rgba(0,255,157,0.15);border:2px solid var(--primary);border-radius:15px;padding:20px;text-align:center;cursor:pointer;transition:0.4s;h3{font-size:1.6em;margin:10px 0;}";

            if (i === 0) {
                 div.style.cssText += "background:var(--primary);color:#000;transform:translateY(-10px);box-shadow:0 15px 30px rgba(0,255,157,0.4);";
            }
            
            div.onclick = ()=>{ 
                document.querySelectorAll("#packages .pkg").forEach(e => {
                    e.classList.remove("active");
                    e.style.cssText = "background:rgba(0,255,157,0.15);border:2px solid var(--primary);border-radius:15px;padding:20px;text-align:center;cursor:pointer;transition:0.4s;";
                });
                
                div.classList.add("active");
                div.style.cssText = "background:var(--primary);color:#000;transform:translateY(-10px);box-shadow:0 15px 30px rgba(0,255,157,0.4);border:2px solid var(--primary);border-radius:15px;padding:20px;text-align:center;cursor:pointer;transition:0.4s;";

                selectedPkg=p; 
            };
            if(i===0) selectedPkg=p;
            container.appendChild(div);
        });
        
        document.querySelectorAll(".pay").forEach(p => {
             const img = p.querySelector("img");
             if (p.classList.contains("active")) {
                img.style.borderColor = "var(--primary)";
                img.style.boxShadow = "0 0 20px rgba(0,255,157,0.6)";
             } else {
                 img.style.borderColor = "transparent";
                 img.style.boxShadow = "none";
             }
         });
    }

    loadPackages();
    document.getElementById("game").onchange = loadPackages;

    document.querySelectorAll(".pay").forEach(p => {
        p.onclick = () => {
            document.querySelectorAll(".pay").forEach(e => { 
                const img = e.querySelector("img");
                img.style.borderColor = "transparent"; 
                img.style.boxShadow = "none";
                e.classList.remove("active"); 
            });
            
            const img = p.querySelector("img");
            img.style.borderColor = "var(--primary)";
            img.style.boxShadow = "0 0 20px rgba(0,255,157,0.6)";
            p.classList.add("active");
            selectedPay = p.dataset.pay;
        };
    });

    window.submitOrder = async function() {
        let userId = document.getElementById("userId").value.trim();
        let refNumber = document.getElementById("refNumber").value.trim();
        const cleanId = userId.replace(/[()]/g,'');
        const cleanRef = refNumber.replace(/[()]/g,'');
        
        if(!cleanId || !selectedPkg || cleanRef.length!==5){
            alert("အားလုံးကို မှန်ကန်စွာ ဖြည့်ပေးပါ။");
            return;
        }

        document.querySelector("button[onclick='submitOrder()']").style.display="none";
        document.getElementById("loadingBtn").style.display="block";

        const message = `
*KP Top Up မှာယူမှု အသစ်* (လုံခြုံစနစ်)

*ဝယ်သူ အချက်အလက်*
အမည်: ${currentUser.name}
အီးမေးလ်: ${currentUser.email}
Google ID (Ban လုပ်ရန်): ${currentUser.id}

ဂိမ်း: ${document.getElementById("game").options[document.getElementById("game").selectedIndex].text}
User ID: ${userId}
ပမာဏ: ${selectedPkg.name}
ဈေးနှုန်း: ${selectedPkg.price}
ငွေပေးချေနည်း: ${selectedPay === "wave" ? "Wave Pay" : "KPay"}
ငွေလွှဲပြေစာ နောက်ဆုံး ၅ လုံး: ${refNumber}

အချိန်: ${new Date().toLocaleString("my-MM")}
        `;

        try {
            await fetch("https://api.telegram.org/bot8565432520:AAFbW60KA7GUXuTx_MQJNT_iFEWr73lHvm8/sendMessage", {
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify({chat_id:7070690379, text:message, parse_mode:"Markdown"})
            });
            alert("အောင်မြင်စွာ ပို့ပြီးပါပြီ!\nAdmin က မကြာခင် ထည့်ပေးပါမည်။");
        } catch(e) {
            alert("အင်တာနက်ပြဿနာ ရှိနေပါသည်။");
        }

        document.querySelector("button[onclick='submitOrder()']").style.display="block";
        document.getElementById("loadingBtn").style.display="none";
    };
}

// Google Sign-In Button ထည့်ပေးတယ်
window.onload = () => {
    google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: onSignIn
    });
    google.accounts.id.renderButton(
        document.getElementById("googleSignIn"),
        { theme: "outline", size: "large", text: "signin_with", width: "300", logo_alignment: "left" }
    );
    google.accounts.id.prompt();
};
</script>

</body>
</html>
